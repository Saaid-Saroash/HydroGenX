<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HydroGenX</title>
  <style>
    body {
      font-family: 'Courier New', Courier, monospace;
      background: linear-gradient(rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.8)), url('img.jpg') no-repeat center center fixed;
      background-size: cover;
      color: #00FF41;
      display: flex;
      flex-direction: column;
      height: 100vh;
      padding: 20px;
      margin: 0;
    }
    .status-box,
    .control {
      background: rgba(0, 0, 0, 0.7);
      border: 2px solid #00FF41;
      padding: 10px;
      text-align: center;
      border-radius: 8px;
      box-shadow: 0 0 10px #00FF41;
    }
    .status-box {
      width: 150px;
      margin: 0 auto 20px;
    }
    .control-panel {
      position: absolute;
      left: 20px;
      top: 100px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      width: 300px;
    }
    .loading-bar {
      width: 100%;
      background: #222;
      border: 1px solid #00FF41;
      height: 20px;
      margin-top: 10px;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: inset 0 0 5px #00FF41;
    }
    .loading-bar div {
      height: 100%;
      background: linear-gradient(90deg, #0000FF, #0000A0);
      width: 0;
      transition: width 0.5s ease-in-out;
    }
    button,
    input {
      padding: 10px;
      margin-top: 10px;
      width: 100%;
      font-size: 18px;
      border-radius: 5px;
      border: none;
      box-shadow: 0 0 5px #00FF41;
    }
    button {
      background: linear-gradient(to right, #00FF41, #006600);
      color: #121212;
      cursor: pointer;
    }
    input {
      background: rgba(255, 255, 255, 0.1);
      color: #00FF41;
      border: 1px solid #00FF41;
      box-sizing: border-box;
    }
    .hidden {
      display: none;
    }
    .modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10;
      width: 50%;
      text-align: center;
      background: rgba(0, 0, 0, 0.7);
      border: 2px solid #00FF41;
      padding: 20px;
      border-radius: 8px;
      color: #00FF41;
    }
    #cmdBox {
      position: absolute;
      bottom: 100px;
      right: 20px;
      width: 300px;
      height: 50vh;
      background: rgba(0, 0, 0, 0.8);
      border: 2px solid #00FF41;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 0 15px #00FF41;
      color: #00FF41;
      overflow-y: auto;
      font-family: 'Courier New', Courier, monospace;
    }
    #cmdBox pre {
      margin: 0;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
  </style>
</head>
<body>
  <div class="status-box" id="status">Device Offline</div>

  <div class="control-panel">
    <div class="control">
      <button id="onOffSwitch">Power Up</button>
      <div id="loading" class="loading-bar hidden"><div></div></div>
    </div>

    <div class="control hidden" id="temperatureControl">
      <div id="temperature">R.TEMP: 27°C</div>
    </div>

    <div class="control hidden" id="batteryControl">
      <div id="battery">Battery: 97%</div>
    </div>

    <div class="control hidden" id="voltageControl">
      <div id="voltage">Voltage: 0.2V</div>
    </div>

    <div class="control hidden" id="efficiencyControl">
      <div id="efficiency">C.TEMP: 27°C</div>
    </div>

    <div class="control">
      <button id="shutdownBtn">Emergency Shutdown</button>
    </div>

    <div class="control">
      <button id="killSwitchBtn">Kill Switch</button>
    </div>
  </div>

  <div id="cmdBox">
    <pre id="cmdOutput">Welcome to the HydroGenX Interface</pre>
  </div>

  <script>
    const elements = {
      status: document.getElementById('status'),
      onOffSwitch: document.getElementById('onOffSwitch'),
      shutdownBtn: document.getElementById('shutdownBtn'),
      killSwitchBtn: document.getElementById('killSwitchBtn'),
      loading: document.getElementById('loading'),
      temperature: document.getElementById('temperature'),
      battery: document.getElementById('battery'),
      voltage: document.getElementById('voltage'),
      efficiency: document.getElementById('efficiency'),
      cmdOutput: document.getElementById('cmdOutput')
    };

    let isOn = false;
    const PASSWORD = "5896"; // Password remains the same

    // Simulation variables – these will be persisted if the system is on.
    let currentTempR;
    let currentTempC;
    let currentVoltage;

    // Simulation targets and settings
    const targetTempR = 73;
    const targetTempC = 80;
    const voltageTarget = 15;
    const voltageTotalTime = 45000; // 45 seconds in ms
    const voltageIntervalTime = 2000; // update every 2 seconds

    // Helper functions for localStorage updates
    function saveState() {
      localStorage.setItem('isOn', isOn);
      localStorage.setItem('currentTempR', currentTempR);
      localStorage.setItem('currentTempC', currentTempC);
      localStorage.setItem('currentVoltage', currentVoltage);
      localStorage.setItem('cmdOutput', elements.cmdOutput.textContent);
    }

    function restoreState() {
      isOn = localStorage.getItem('isOn') === "true";
      currentTempR = localStorage.getItem('currentTempR') ? parseInt(localStorage.getItem('currentTempR')) : (Math.floor(Math.random() * 6) + 27);
      currentTempC = localStorage.getItem('currentTempC') ? parseInt(localStorage.getItem('currentTempC')) : (Math.floor(Math.random() * 6) + 27);
      currentVoltage = localStorage.getItem('currentVoltage') ? parseFloat(localStorage.getItem('currentVoltage')) : 0.2;
      const storedLog = localStorage.getItem('cmdOutput');
      if (storedLog) {
        elements.cmdOutput.textContent = storedLog;
      }
    }

    // Logging to cmdOutput and saving to storage
    function logCmdOutput(message) {
      elements.cmdOutput.textContent += '\n' + message;
      elements.cmdOutput.scrollTop = elements.cmdOutput.scrollHeight;
      saveState();
    }

    // Toggle element visibility helper
    function toggleVisibility(element, show) {
      element.classList.toggle('hidden', !show);
    }

    // Update an element's text
    function updateElementText(element, text) {
      element.textContent = text;
    }

    // Show/hide the loading bar (simple simulation)
    function toggleLoading(state) {
      toggleVisibility(elements.loading, state);
    }

    // Start the simulation controls
    function startControls() {
      // The battery is fixed at 97%
      updateElementText(elements.battery, "Battery: 97%");
      saveState();

      // Calculate voltage increment per interval
      const voltageSteps = voltageTotalTime / voltageIntervalTime;
      const voltageIncrement = (voltageTarget - currentVoltage) / voltageSteps;

      // Update R.TEMP gradually until targetTempR with a random interval between 2-5 seconds
      function updateRTEMP() {
        if (!isOn) return;
        if (currentTempR < targetTempR) {
          currentTempR += 1;
          if (currentTempR > targetTempR) currentTempR = targetTempR;
        }
        updateElementText(elements.temperature, `R.TEMP: ${currentTempR}°C`);
        saveState();
        const nextInterval = Math.floor(Math.random() * 3000) + 2000; // 2000-5000ms
        setTimeout(updateRTEMP, nextInterval);
      }

      // Update C.TEMP gradually until targetTempC with a random interval between 2-5 seconds
      function updateCTEMP() {
        if (!isOn) return;
        if (currentTempC < targetTempC) {
          currentTempC += 1;
          if (currentTempC > targetTempC) currentTempC = targetTempC;
        }
        updateElementText(elements.efficiency, `C.TEMP: ${currentTempC}°C`);
        saveState();
        const nextInterval = Math.floor(Math.random() * 3000) + 2000;
        setTimeout(updateCTEMP, nextInterval);
      }

      // Update Voltage gradually from currentVoltage to voltageTarget over 45 seconds
      const voltageInterval = setInterval(() => {
        if (!isOn) {
          clearInterval(voltageInterval);
          return;
        }
        if (currentVoltage < voltageTarget) {
          currentVoltage += voltageIncrement;
          if (currentVoltage > voltageTarget) currentVoltage = voltageTarget;
          updateElementText(elements.voltage, `Voltage: ${currentVoltage.toFixed(1)}V`);
          saveState();
        } else {
          clearInterval(voltageInterval);
        }
      }, voltageIntervalTime);

      // Start the recursive updates
      updateRTEMP();
      updateCTEMP();
    }

    // Toggle power state and update the UI accordingly.
    function togglePower() {
      if (!isOn) {
        logCmdOutput('Starting system...');
        toggleLoading(true);
        setTimeout(() => {
          elements.status.textContent = 'Active';
          elements.onOffSwitch.textContent = 'Power Down';
          isOn = true;
          toggleLoading(false);
          // Make sensor controls visible
          toggleVisibility(document.getElementById('temperatureControl'), true);
          toggleVisibility(document.getElementById('batteryControl'), true);
          toggleVisibility(document.getElementById('voltageControl'), true);
          toggleVisibility(document.getElementById('efficiencyControl'), true);
          logCmdOutput('System powered up.');
          // Start the simulation – use restored values if available.
          startControls();
          saveState();
        }, 2000);
      } else {
        logCmdOutput('Shutting down system...');
        toggleLoading(true);
        setTimeout(() => {
          elements.status.textContent = 'Device Offline';
          elements.onOffSwitch.textContent = 'Power Up';
          isOn = false;
          toggleLoading(false);
          // Hide sensor controls
          toggleVisibility(document.getElementById('temperatureControl'), false);
          toggleVisibility(document.getElementById('batteryControl'), false);
          toggleVisibility(document.getElementById('voltageControl'), false);
          toggleVisibility(document.getElementById('efficiencyControl'), false);
          logCmdOutput('System powered down.');
          // Clear simulation values from storage
          localStorage.removeItem('currentTempR');
          localStorage.removeItem('currentTempC');
          localStorage.removeItem('currentVoltage');
          saveState();
        }, 2000);
      }
    }

    // Request a password then perform the provided action if correct.
    function requestPassword(action) {
      let userPassword = prompt("Enter password:");
      if (userPassword === PASSWORD) {
        action();
      } else {
        logCmdOutput('Access denied: Incorrect password');
        alert("Incorrect password!");
      }
    }

    // Emergency shutdown routine.
    function emergencyShutdown() {
      logCmdOutput('Emergency Shutdown initiated!');
      alert("Emergency Shutdown activated!");
      elements.status.textContent = 'Emergency Shutdown';
      elements.onOffSwitch.textContent = 'Power Up';
      isOn = false;
      toggleVisibility(document.getElementById('temperatureControl'), false);
      toggleVisibility(document.getElementById('batteryControl'), false);
      toggleVisibility(document.getElementById('voltageControl'), false);
      toggleVisibility(document.getElementById('efficiencyControl'), false);
      // Remove simulation state
      localStorage.removeItem('currentTempR');
      localStorage.removeItem('currentTempC');
      localStorage.removeItem('currentVoltage');
      saveState();
    }

    // Kill switch routine.
    function killSwitch() {
      logCmdOutput('Kill Switch activated! System locked.');
      alert("Kill Switch activated! System locked.");
      document.body.innerHTML = "<h1 style='color:red; text-align:center;'>SYSTEM LOCKED</h1>";
      // Optionally, you could clear storage here if desired.
      localStorage.clear();
    }

    // Event listeners for buttons.
    elements.onOffSwitch.addEventListener('click', togglePower);
    elements.shutdownBtn.addEventListener('click', () => requestPassword(emergencyShutdown));
    elements.killSwitchBtn.addEventListener('click', () => requestPassword(killSwitch));

    // Restore state when the page loads.
    document.addEventListener("DOMContentLoaded", () => {
      restoreState();
      if (isOn) {
        // Restore the UI for an active system.
        elements.status.textContent = 'Active';
        elements.onOffSwitch.textContent = 'Power Down';
        toggleVisibility(document.getElementById('temperatureControl'), true);
        toggleVisibility(document.getElementById('batteryControl'), true);
        toggleVisibility(document.getElementById('voltageControl'), true);
        toggleVisibility(document.getElementById('efficiencyControl'), true);
        logCmdOutput('System restored from previous session.');
        startControls();
      }
    });
  </script>
</body>
</html>
